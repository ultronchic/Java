# Ticket Sale App

## Настройки Maven
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd">
<localRepository>Macintosh HD/пользователи/ultronchic/my-local-repo</localRepository>
</settings>
# Логика работы приложения  
Финальное задание ТЗ. Логика работы приложения
Стандартный Spring Web MVC CRUD проект

Выбор темы самостоятельно: продажа билетов в кино, библиотека, отзывы на учебные курсы и т.д.
Структура проекта: Spring Web MVC либо REST+JS.
Список функций: отобразить данные из базы, отредактировать данные в базе, удалить данные из базы.
Имеет хотя бы две таблицы в БД и редактирование данных в обеих.

Приложение по продаже билетов на Java с использованием Spring Web MVC. Страница с адресом (продажа билетов, возврат билетов на 3 доступных фильма) запускается локально через порт 8080.
Запускается приложение в браузере и позволяет:
1. отобразить данные о билетах доступных к покупке на три фильма Marvel "Черная Вдова", Marvel "Капитан Америка другой Мир" и Marvel "Мстители Война бесконечности".
2. позволяет купить билет на один из трех фильмов через сайт. На каждый фильм доступно по 3 билета доступных к покупке. Для покупки покупатель на сайте нажимает на кнопку рядом с фильмом "Купить билет". Страница отображает значение из таблицы «билеты» из базы с актуальным статусом («в наличии», «продан») каждого билета на каждый фильм. Статус билета «продан» записывается в базу, когда пользователь на сайте нажал кнопку «купить билет».
3. после нажатия на кнопку "купить билет" уменьшается на 1 количество билетов доступных к покупке каждого фильма. Каждому фильму доступно к покупке 3 билета.
4. при нажатии на кнопку "отменить покупку" запись о проданном билете в базе обнуляется до предыдущего значения количества доступных билетов доступных к покупке до покупки билета.
   Структура базы данных проекта содержит 3 таблицы (уникальный ключ таблиц уникальный номер-id билета, уникальный номер -id фильма, уникальный номер – id пользователя):
1. таблица с фильмами «Films». В базу внесены записи о трех фильмах (Marvel "Черная Вдова", Marvel "Капитан Америка другой Мир" и Marvel "Мстители Война бесконечности"). Таблица содержит столбцы «уникальный id-фильма», «название фильма» (Marvel "Черная Вдова", Marvel "Капитан Америка другой Мир" и Marvel "Мстители Война бесконечности"), «количество доступных к покупке билетов» (на каждый фильм доступно к покупке 3 билета), «уникальный id билета 1», «уникальный id билета 2», «уникальный id билета 3», «куплено билетов» - заполняется значением купленных билетов на каждый фильм;
2. таблица с билетами «Tickets» имеет столбцы: «уникальный id пользователя» (вошедшего на сайт), «уникальный id-фильма», «уникальный номер билета», «статус билета (продан, в наличии)»;
3. таблица пользователей «Users» имеет столбцы: «уникальный id пользователя», вошедшего на сайт, «статус пользователя» «гость» или «покупатель», «уникальный id фильма», который купил пользователь. Как только пользователь, вошедший на сайт, нажал кнопку «купить билет» его статус в таблице пользователя меняется с «гость» на «покупатель»;
4. таблица действий пользователей «UserActions». Таблица имеет столбцы: уникальный Id пользователя, «покупка билета на фильм», «уникальный номер Id- билета», «уникальный номер Id- фильма», «название фильма», «дата и время действия»- регистрируется дата и время нажатия пользователем на сайте на кнопки «купить билет» и «вернуть билет».
   Действие «покупка билета на фильм» регистрируется если пользователь нажал на кнопку «купить билет» с регистрацией имени фильма и уникальным номером билета, «номер билета», «название фильма».
   Действие «возврат билета на фильм» регистрируется: если пользователь нажал на кнопку «вернуть билет» создается запись в таблице действий пользователей «возврат билета на фильм»
   CRUD:
1.	Create: при покупке каждого билета на сайте через нажатие на кнопку «купить билет» создается строка в базе данных в таблице «билеты» с доступным к покупке билетом со статусом «продан». На сайте пользователю выдается pop-уведомление «билет теперь ваш», кол-во доступных билетов на фильм, на который был куплен билет, уменьшается на 1;
      a.	Read: при входе на сайт вычитывается/отображается из базы данных (таблица TABLE Films (
      id SERIAL PRIMARY KEY,
      title VARCHAR(255) NOT NULL,
      available_tickets INT NOT NULL DEFAULT 3,
      sold_tickets INT NOT NULL DEFAULT 0
      );) информация о доступных к покупке билетах «билеты в наличии», фильмах доступных к просмотру (Marvel "Черная Вдова", Marvel "Капитан Америка другой Мир" и Marvel "Мстители Война бесконечности"), фильмов на которые продаются билеты, Таблица первоначально уже заполнена данными о трех фильмах Marvel "Черная Вдова", Marvel "Капитан Америка другой Мир" и Marvel "Мстители Война бесконечности". Данные в интерфейс выводятся при каждом входе пользователя на страницу.
2.	Update:
      a.	при покупке билета - нажатии на сайте на кнопку «купить билет» производится update статуса билета в таблице «билет» со статуса «в наличии» на «продан»;
      b.	при покупке билета – нажатии на сайте на кнопку «купить билет» в таблице с фильмами значение в столбце «количество доступных к покупке билетов» уменьшается на 1, при одновременном увеличении на 1 значения в столбце «куплено билетов» на данный конкретный фильм.;
      c.	при возврате билета на фильм покупателем на сайте, при нажатии на кнопку «вернуть билет» осуществляется возврат билета и одновременно:
      i.	Статус билета в таблице билетов меняется на «в наличии»;
      ii.	Статус пользователя в таблице «пользователь» в столбце «статус пользователя» меняется значение с «покупатель» на «гость»;
      iii.	Количество доступных билетов к покупке (столбец «количество доступных к покупке билетов») на фильм в таблице «Films» увеличивается на 1, а значение в столбце «куплено билетов» на фильм уменьшается на 1;
3.	Delete (функция удаления данных из таблицы в базы данных «UserActions»): по истечении 2-х дней данные из таблицы действий пользователей удаляются автоматически начиная с самого раннего. Срок хранения строк в таблице «UserActions» составляет 2 дня. На третий день считая с даты и времени действия пользователя значение в столбце «дата и время действия».

      

Структура проекта должны быть следующей:
ticket-sale/
│
├── backend/                     # Папка для бэкенда
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── com/
│   │   │   │       └── example/
│   │   │   │           └── ticketsale/
│   │   │   │               ├── TicketSaleApplication.java  # Главный класс приложения
│   │   │   │               ├── controller/                 # Контроллеры
│   │   │   │               │    └── TicketController.java
│   │   │   │               ├── service/                    # Сервисы
│   │   │   │               │    ├── FilmService.java
│   │   │   │               │    ├── TicketService.java
│   │   │   │               │    └── UserService.java
│   │   │   │               └── repository/                 # Репозитории (DAO)
│   │   │                   └── FilmRepository.java
│   │                       └── resources/
│   │                           ├── application.properties     # Конфигурация приложения
│   |                           └── static/                   # Статические файлы (если нужно)
│   |                               └── index.html             # Главная страница (можно использовать)
│   
├── frontend/                    # Папка для фронтенда
│    ├── index.html              # Главная HTML страница
│    ├── css/                    # Папка для CSS файлов
│    |    └── styles.css         # Стили для страницы
│    └── js/                     # Папка для JavaScript файлов
│         └── app.js             # Логика приложения на JavaScript
|
├── database/                    # Скрипты для работы с базой данных 
|    └── schema.sql              # SQL скрипт для создания таблиц и начальных данных
|
└── README.md                    # Документация проекта


CREATE TABLE Films (
id SERIAL PRIMARY KEY,
title VARCHAR(255) NOT NULL,
available_tickets INT NOT NULL DEFAULT 3,
sold_tickets INT NOT NULL DEFAULT 0
);

CREATE TABLE Tickets (
id SERIAL PRIMARY KEY,
user_id INT,
film_id INT,
moovie_time TIME,
moovie_date DATE,
ticket_number INT,
status VARCHAR(20) DEFAULT 'available',
FOREIGN KEY (film_id) REFERENCES Films(id)
);

CREATE TABLE Users (
id SERIAL PRIMARY KEY,
status VARCHAR(20) DEFAULT 'guest',
timeAction TIMESTAMP,
dateAction CURRENT_DATE
);

CREATE TABLE UserActions (
id SERIAL PRIMARY KEY,
user_id INT,
action_type VARCHAR(50),
ticket_id INT,
film_id INT,
film_title VARCHAR(255),
action_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

